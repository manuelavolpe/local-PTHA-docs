<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://manuelavolpe.github.io/local-PTHA-docs/steps/step5/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>STEP 5: Tsunami simulations - Local PTHA documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../stylesheets/extra.css" rel="stylesheet" />
        <link href="https://unpkg.com/katex@0/dist/katex.min.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "STEP 5: Tsunami simulations";
        var mkdocs_page_input_path = "steps/step5.md";
        var mkdocs_page_url = "/local-PTHA-docs/steps/step5/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../..">
          <img src="../../images/projects.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Home</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../..">Index</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../abbreviations/">Table of Abbreviations</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Background</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../background/l-ptha/">Local-scale PTHA</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../background/neamthm18/">The regional hazard model NEAMTHM18</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../background/nested_grids/">Telescopic nested grids</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../background/thysea/">The Tsunami-HySEA code</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Instructions</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../instructions/how-to-download.md">None</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../instructions/installation/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../instructions/json_input/">The JSON input file</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../instructions/requirements/">Requirements</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../instructions/usage/">Usage</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Spack</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../spack/env_spack/">How to use Spack</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../spack/leonardo/">Instructions for Leonardo</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../spack/mercalli/">Instructions for Mercalli</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../spack/useful_commands/">Useful Spack commands</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Conda</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../conda/conda/">Setting a conda environment</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Steps</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../overview/">General overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../step1/">STEP 1: POI(s) selection</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../step2/">STEP 2: Scenario dumping</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../step3/">STEP 3: Scenario selection</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../step4/">STEP 4: Scenario rates</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">STEP 5: Tsunami simulations</a>
    <ul class="current">
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../step6/">STEP 6: Hazard aggregation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../step7/">STEP 7: Hazard visualization</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Local PTHA documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Steps</li>
      <li class="breadcrumb-item active">STEP 5: Tsunami simulations</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/manuelavolpe/local-PTHA-docs/edit/master/docs/steps/step5.md">Edit on manuelavolpe/local-PTHA-docs</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="step-5-tsunami-simulations"><strong>STEP 5: Tsunami simulations</strong></h1>
<p>This step requires NVIDIA GPUs, in particular V100 or A100 cards (other architectures are expected to be supported in the future), to run the tsunami numerical simulations on <a href=../../background/nested_grids target="_blank">nested topo-bathymetric grids</a>, using the <a href=../../background/thysea target="_blank">Tsunami-HySEA</a> code (MC version), for each scenario selected by <a href=../../steps/step5 target="_blank">Step 3</a>. The typical number of sources to be modeled is <span class="arithmatex">\(O(10^3-10^5)\)</span>.</p>
<p>Before starting, the "SIMULATION SETUP" section within the <a href=../../instructions/json_input target="_blank">JSON input file</a> must be completed, and the topo-bathymetric grids must be available in the folder declared at the beginning of the JSON file. Moreover, if the workflow is running on Leonardo@CINECA, the last 3 lines in the "HPC" section of the JSON file must be filled as well.</p>
<p>Simulations are carried out separately for each seismicity type, and different templates of the parameter files are provided within the folder <code>templates</code>. In brief, when executing this step, a new output folder called SIMULATIONS is created, and</p>
<ul>
<li>the simulation setup is prepared</li>
<li>simulations are launched (i.e. submitted to the queue)</li>
<li>post-processing is performed.</li>
</ul>
<p>Depending on the HPC cluster, the simulations are grouped in packages made by as many simulations as GPUs on each computational node. In other words, each job is submitted on one single node and executes in parallel a number of simulations equal to the number of GPUs per node. Specifically, jobs made by 8 simulations are submitted on Mercalli@INGV (8 GPUs/node) and jobs made by 4 simulations are submitted on Leonardo@CINECA (4 GPUs/node). This choice represents a trade-off between an optimal usage of the computational resources and the control of the failures in case of node crashes. It is worth noting that each simulation will run in parallel on a single GPU, provided that computational nodes are available.</p>
<details class="warning" open="open">
<summary>Warning</summary>
<p>On Leonardo@CINECA a limit of 1000 simultaneous jobs per user is allowed. This means that if the total number of simulations overcomes 4000, then not all the simulations can be submitted in one shot and some manual operations are needed to execute them in multiple runs, for example by separating each seismicity type, provided that you have less than 4000 scenarios for each of them. The issue will be solved by allowing the use of more than one node per each job.</p>
</details>
<p>For each simulation, the maximum tsunami wave amplitude at each point in the highest resolution grid is saved, which is then converted into flow-depth (i.e. the water height on land) through a post-processing operation, transparent to the user, performed within the same job. Additionally, the tsunami time series at the selected POIs are also saved for further use.</p>
<p>It is worth noting that the simulations are organized in separate folders, one for each seismicity type and, inside that, one for each scenario.</p>
<details class="tip" open="open">
<summary>Tip</summary>
<p>It's a good practice to check at the end of this step if all the simulations succeeded, since some failures, due to node crashes or other technical issues, can always occur. One possible way to do that is to count the number of files <code>*_flowdepth.nc</code> in the simulation folders, which must be equal to the number of scenarios if one site (i.e. one grid nesting) is being considered, or in general equal to the number of scenarios <span class="arithmatex">\(\times\)</span> number of sites.</p>
</details>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../step4/" class="btn btn-neutral float-left" title="STEP 4: Scenario rates"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../step6/" class="btn btn-neutral float-right" title="STEP 6: Hazard aggregation">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/manuelavolpe/local-PTHA-docs" class="fa fa-code-fork" style="color: #fcfcfc"> manuelavolpe/local-PTHA-docs</a>
        </span>
    
    
      <span><a href="../step4/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../step6/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../javascripts/mathjax.js"></script>
      <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../../javascripts/katex.js"></script>
      <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
